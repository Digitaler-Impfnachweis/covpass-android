class Config {
    Boolean kotlinExplicitApiMode = true
}

ext.kotlinLibrary = { args = [:] ->
    apply from: "$rootDir/gradle/common/kotlin-common.gradle"

    apply plugin: 'java-library'
    apply plugin: 'kotlin'

    Config config = new Config(args)

    kotlinCommon()

    compileKotlin {
        kotlinOptions {
            jvmTarget = "1.8"
            freeCompilerArgs = getCompilerArgs(kotlinExplicitApiMode: config.kotlinExplicitApiMode)
        }
    }

    compileTestKotlin {
        kotlinOptions {
            jvmTarget = "1.8"
            freeCompilerArgs = getCompilerArgs(kotlinExplicitApiMode: config.kotlinExplicitApiMode)
        }
    }

    // Behave like Android
    task testDebugUnitTest(type: Test, dependsOn: ['test'], group: 'verification')
}
